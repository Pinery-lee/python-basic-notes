# 模型参数量和模型大小

### 1.模型参数量和模型大小的定义

- **模型参数量 (Params)**: 指模型中可训练参数的总数 (神经元连接数)，通常是指构成深度学习模型的所有权重（weights）和偏置（biases）的总数。模型大小通常是通过模型的总参数数量来衡量的。一般来说，具有更多参数的模型通常需要更多的计算资源和内存来进行训练和推理。

- **模型大小 (Size)**: 即模型文件的存储大小（如 500 MB）。因为存在使用不同位深 (bit) 导致模型文件大小极大不同的情况，所以一般我们说的模型大小会使用模型参数量去衡量。

### 2.模型参数量和模型大小的准确换算

- 假设模型文件仅仅存储了权重和偏置
- 参数量 * 带宽 (存储格式字节数) = 模型大小

$$
7 B * 4 B y t e s(32 b i t s)=28 G B\left(1024 ^ 3 \text { Bytes }\right)
$$

- 事实上，不可能只存储权重和偏置，例如， `.pth` 文件还要存储层归一化的统计参数、 pickled 字符串和元数据等，所以一般按照上述公式计算出的模型大小会略小于真实存储的模型大小

### 3.模型参数量和模型大小的快速估算

- 32位浮点数存储：参数量 (B) → 模型大小 (GB)： $1B = 4 GB$    $1M = 4 MB$
- 16位整数存储：参数量 (B) → 模型大小 (GB)： $1B = 2 GB$    $1M = 2 MB$
- 8位整数存储：参数量 (B) → 模型大小 (GB)： $1B = 1 GB$    $1M = 1 MB$

### 4.目前大模型的模型参数量是多少？

[大模型排行](https://www.datalearner.com/leaderboards)

- 最小大模型参数量： $3 B$
- 最大大模型参数量： $2000 B$ 

### 5.如何在pytorch中查看模型参数量？

- 参数量

```python
# 加载 head
head = LinearSegHead(1024, 8)
head_ckpt = r'D:\siwei_work\2025nongyezu\11_dinov3_seg\dinov3_seg_head.pth'
head.load_state_dict(torch.load(head_ckpt))
# 真正可训练的参数量
trainable_params = sum(p.numel() for p in head.parameters())
print("Trainable Params:", trainable_params)

# state_dict 中全部张量数量
state = torch.load(head_ckpt)
state_params = sum(v.numel() for v in state.values() if torch.is_tensor(v))
print("All tensor in state_dict:", state_params)
```

- 换算模型大小

```python
def estimate_params(size, unit='MB', dtype_bytes=4, binary=True):
    """
    根据模型文件大小估算参数数量

    Args:
        size (float): 文件大小
        unit (str): 'MB' or 'GB'
        dtype_bytes (int): 每个参数占用字节数（FP32=4, FP16=2, INT8=1）
        binary (bool): True=1024进制，False=1000进制

    Returns:
        参数数量（int）
    """
    if binary:
        KB = 1024
    else:
        KB = 1000

    if unit == 'GB':
        bytes_total = size * KB**3
    elif unit == 'MB':
        bytes_total = size * KB**2
    else:
        raise ValueError("unit must be 'MB' or 'GB'")
    
    params = bytes_total / dtype_bytes
    return int(params)


# ----------------- 示例使用 -----------------
if __name__ == "__main__":
    size_mb = 36916/1024  # 例子：模型36916KB
    params_fp32 = estimate_params(size_mb, unit='MB', dtype_bytes=4, binary=True)
    print(f"FP32 参数量: {params_fp32:,} (~{params_fp32:.1f})")
```

### 6.模型参数量和神经元个数和神经元连接数之间的关系？

**神经元是节点数量，连接是节点之间的映射数量，参数则是模型中所有可学习的数值（包括偏置）**。参数量和连接数接近。